<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç©ºä¸­å¯«å­—æ•™å­¸ç³»çµ± - Firebase ç©©å®šç‰ˆ</title>
    <style>
        body { margin: 0; padding: 0; background: #121212; color: white; font-family: "Microsoft JhengHei", Arial, sans-serif; overflow: hidden; }
        .page { display: none; width: 100vw; height: 100vh; position: absolute; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }
        .card { background: rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 20px; backdrop-filter: blur(10px); width: 350px; border: 1px solid rgba(255,255,255,0.2); text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: none; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 10px; border: none; background: #00FF00; color: black; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { transform: scale(1.02); }
        button:disabled { background: #555; cursor: not-allowed; transform: none; }
        #page_teacher_dash { overflow-y: auto; justify-content: flex-start; padding: 20px 0; }
        .dash-container { width: 95%; max-width: 1000px; display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .monitor-panel { background: rgba(255, 255, 255, 0.08); padding: 18px; border-radius: 15px; flex: 1; min-width: 320px; border: 1px solid rgba(255,255,255,0.1); }
        .room-manager { width: 95%; max-width: 1000px; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .room-chip { background: #333; padding: 5px 12px; border-radius: 20px; display: flex; align-items: center; gap: 8px; border: 1px solid #555; cursor: pointer; font-size: 14px; }
        .room-chip.active { border-color: #00FF00; background: rgba(0,255,0,0.1); color: #00FF00; }
        .room-chip .del-x { color: #ff4d4d; font-weight: bold; cursor: pointer; padding: 2px 5px; }
        #page_writing { background: #000; }
        #input_video { visibility: hidden; position: absolute; }
        #overlay_canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .writing-ui { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        .writing-info { background: rgba(0,0,0,0.8); padding: 15px; border-radius: 12px; border: 2px solid #00FF00; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; background: rgba(0,0,0,0.4); }
        th, td { border: 1px solid rgba(255,255,255,0.1); padding: 10px; text-align: center; }
        th { background: #222; color: #00FF00; }
        .work-thumb { width: 40px; height: 30px; border: 1px solid #00FF00; cursor: pointer; object-fit: cover; background: #000; border-radius: 4px; transform: scaleX(-1); }
        #artwork_modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); z-index: 3000; justify-content: center; align-items: center; }
        #big_art { max-width: 90%; max-height: 80%; border: 2px solid white; border-radius: 10px; transform: scaleX(-1); }
        #artwork_modal .close-art { position: absolute; top: 30px; right: 40px; color: white; font-size: 40px; cursor: pointer; font-weight: bold; }
        #result_modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 30px; text-align: center; z-index: 2000; min-width: 320px; color: black; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        #res_score { font-size: 80px; font-weight: bold; color: #2c3e50; }
    </style>
</head>
<body>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, query, where, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDk5l70PQPSb0pIl6q-eyXU1IBF093F9FQ",
            authDomain: "writing-3646d.firebaseapp.com",
            databaseURL: "https://writing-3646d-default-rtdb.firebaseio.com",
            projectId: "writing-3646d",
            storageBucket: "writing-3646d.firebasestorage.app",
            messagingSenderId: "268020200454",
            appId: "1:268020200454:web:d0b12c77a91efeecf33f87",
            measurementId: "G-HSSVJEQC95"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.firebaseDB = { db, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, query, where, deleteDoc, getDocs };

        async function loginAsTeacher() {
            const accountInput = document.getElementById('teacherAccount').value;
            const passwordInput = document.getElementById('teacherPassword').value;
            if (!accountInput || !passwordInput) { alert("è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼"); return; }
            try {
                const docRef = doc(db, "admins", accountInput);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const adminData = docSnap.data();
                    if (adminData.password === passwordInput) {
                        alert("ç™»å…¥æˆåŠŸï¼");
                        showPage('page_teacher_dash');
                    } else { alert("å¯†ç¢¼éŒ¯èª¤ï¼"); }
                } else { alert("æ‰¾ä¸åˆ°å¸³è™Ÿï¼"); }
            } catch (e) { alert("ç³»çµ±éŒ¯èª¤"); }
        }
        window.loginAsTeacher = loginAsTeacher;
    </script>

    <div id="artwork_modal" onclick="closeArt()"><span class="close-art">&times;</span><img id="big_art" src=""><div id="art_info" style="position: absolute; bottom: 50px; color: white; font-size: 20px;"></div></div>

    <div id="page_entry" class="page active">
        <h1>ç©ºä¸­å¯«å­—æ•™å­¸ç³»çµ±</h1>
        <div class="card">
            <button onclick="showPage('page_teacher_login')">è€å¸«ç®¡ç†ç«¯</button>
            <button onclick="showPage('page_student_info')" style="background: white;">å­¸ç”Ÿç·´ç¿’ç«¯</button>
        </div>
    </div>

    <div id="page_teacher_login" class="page">
        <div class="card">
            <h2>è€å¸«ç™»å…¥</h2>
            <input type="text" id="teacherAccount" placeholder="å¸³è™Ÿ">
            <input type="password" id="teacherPassword" placeholder="å¯†ç¢¼">
            <button onclick="loginAsTeacher()">ç™»å…¥</button>
            <button onclick="showPage('page_entry')" style="background:none; color:#aaa;">è¿”å›</button>
        </div>
    </div>

    <div id="page_teacher_dash" class="page">
        <div class="room-manager">
            <span style="font-size:14px; color:#aaa;">æˆ¿è™Ÿç®¡ç†:</span>
            <div id="room_chips_container" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
            <div style="display:flex; gap:5px; margin-left:auto;">
                <input type="text" id="class_room_id" placeholder="æ–°æˆ¿è™Ÿ" style="margin:0; padding:5px; width:80px; font-size:12px;">
                <button onclick="saveRoomID()" style="margin:0; padding:5px 10px; width:auto; font-size:12px;">æ–°å¢</button>
            </div>
        </div>
        <div class="dash-container">
            <div class="monitor-panel">
                <h4>å–®å­—ç®¡ç†</h4>
                <div style="display:flex; gap:10px;"><input type="text" id="new_word" placeholder="æ–°å–®å­—" style="margin:0;"><button onclick="addNewWord()" style="width:80px; margin:0;">åŠ å…¥</button></div>
                <div id="word_list" style="height:150px; overflow-y:auto; background:rgba(0,0,0,0.4); margin-top:10px; border-radius:10px; text-align:left; padding:10px;"></div>
                <div style="display:flex; gap:10px; margin-top:10px;"><button onclick="publishSelectedWords()" style="background:#00FF00;">ç™¼ä½ˆå‹¾é¸</button><button onclick="deleteSelectedWords()" style="background:#ff4d4d; color:white;">é¸æ“‡å‰·é™¤</button></div>
                <div style="font-size:12px; color:#00FF00; margin-top:8px;">ç•¶å‰ç™¼ä½ˆ: <span id="published_display" style="color:#fff;">åŒæ­¥ä¸­...</span></div>
            </div>
            <div class="monitor-panel" style="flex: 2;">
                <h3>æˆç¸¾æ¦œ (æˆ¿è™Ÿ: <span id="room_display" style="color:#00FF00;">--</span>)</h3>
                <div style="max-height: 450px; overflow-y: auto;"><table id="leaderboard"><thead><tr><th>ä½œå“</th><th>ç­ç´šå§“å</th><th>å¹³å‡åˆ†</th><th>æ˜ç´°</th><th>é€²åº¦</th></tr></thead><tbody></tbody></table></div>
                <button onclick="clearScores()" style="background:#666; font-size:12px; margin-top:15px; width:auto; padding:5px 15px;">æ¸…ç©ºæˆ¿å…§æˆç¸¾</button>
            </div>
        </div>
        <button onclick="showPage('page_entry')" style="background:none; color:#aaa; margin-top:20px; cursor:pointer;">ç™»å‡º</button>
    </div>

    <div id="page_student_info" class="page">
        <div class="card">
            <h2>å­¸ç”Ÿç™»è¨˜</h2>
            <input type="text" id="s_class" placeholder="ç­ç´š">
            <input type="text" id="s_name" placeholder="å§“å">
            <input type="text" id="s_room_input" placeholder="æˆ¿è™Ÿ">
            <button onclick="handleStudentEntry()">é€²å…¥ç·´ç¿’</button>
            <button onclick="showPage('page_entry')" style="background:none; color:#aaa;">è¿”å›</button>
        </div>
    </div>

    <div id="page_writing" class="page" style="padding:0;">
        <video id="input_video"></video><canvas id="overlay_canvas"></canvas>
        <div class="writing-ui"><div class="writing-info"><div style="font-size:36px; font-weight:bold; color:#00FF00;" id="target_word">READY</div><div id="progress_info" style="font-size:16px; color:#aaa; margin-top:5px;">é€²åº¦: 0 / 0</div></div></div>
        <div style="position:absolute; bottom:30px; left:50%; transform:translateX(-50%); display:flex; gap:20px;">
            <button onclick="clearCanvas()" style="width:100px; background:white;">é‡å¯«</button>
            <button onclick="calculateFinalScore()" id="btn_submit_score" style="width:150px; background:#00FF00;">æäº¤è©•åˆ†</button>
        </div>
    </div>

    <div id="result_modal"><div style="font-size: 20px;">æœ¬å­—å¾—åˆ†</div><div id="res_score">0</div><div id="res_stars" style="font-size:32px; color:#f1c40f;">â­â­â­</div><button onclick="toNextStep()" style="background:#27ae60; color:white; margin-top:20px; width:100%;">ä¸‹ä¸€å€‹</button></div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
    let cloudData = { roomID: "", roomList: [], wordBank: [], publishedWords: [] };
    let unsubResults = null;

    async function syncConfigFromCloud() {
        const { db, doc, getDoc, setDoc } = window.firebaseDB;
        const configDoc = await getDoc(doc(db, "configs", "main"));
        if (configDoc.exists()) { cloudData = { ...cloudData, ...configDoc.data() }; }
        else { await setDoc(doc(db, "configs", "main"), { roomList: [], wordBank: ["HELLO"], publishedWords: [], roomID: "" }); }
    }

    async function updateCloudConfig(newData) {
        const { db, doc, updateDoc } = window.firebaseDB;
        await updateDoc(doc(db, "configs", "main"), newData);
    }

    async function saveRoomID() {
        const input = document.getElementById('class_room_id');
        let id = input.value.trim();
        if (!id) return;
        await syncConfigFromCloud();
        if (!cloudData.roomList.includes(id)) { cloudData.roomList.push(id); }
        cloudData.roomID = id;
        await updateCloudConfig({ roomList: cloudData.roomList, roomID: id });
        input.value = "";
        renderTeacherDash();
    }

    async function selectRoom(id) {
        cloudData.roomID = id;
        await updateCloudConfig({ roomID: id });
        renderTeacherDash();
    }

    async function deleteRoom(id, event) {
        event.stopPropagation();
        if(confirm(`åˆªé™¤æˆ¿è™Ÿ ${id}ï¼Ÿ`)) {
            await syncConfigFromCloud();
            cloudData.roomList = cloudData.roomList.filter(r => r !== id);
            if(cloudData.roomID === id) cloudData.roomID = "";
            await updateCloudConfig({ roomList: cloudData.roomList, roomID: cloudData.roomID });
            const { db, collection, query, where, getDocs, deleteDoc, doc } = window.firebaseDB;
            const snapshot = await getDocs(query(collection(db, "results"), where("room", "==", id)));
            snapshot.forEach(async (d) => await deleteDoc(doc(db, "results", d.id)));
            renderTeacherDash();
        }
    }

    async function addNewWord() {
        let w = document.getElementById('new_word').value.toUpperCase().trim();
        if(w && !cloudData.wordBank.includes(w)) {
            cloudData.wordBank.push(w);
            await updateCloudConfig({ wordBank: cloudData.wordBank });
            renderWordListOnly();
            document.getElementById('new_word').value = "";
        }
    }

    async function publishSelectedWords() {
        const cbs = document.querySelectorAll('.word-checkbox:checked');
        cloudData.publishedWords = Array.from(cbs).map(c => c.value);
        await updateCloudConfig({ publishedWords: cloudData.publishedWords });
        renderTeacherDash();
        alert("å·²ç™¼ä½ˆè‡³å­¸ç”Ÿç«¯");
    }

    async function deleteSelectedWords() {
        const cbs = document.querySelectorAll('.word-checkbox:checked');
        const toDel = Array.from(cbs).map(c => c.value);
        if(confirm("ç¢ºå®šå‰·é™¤ï¼Ÿ")) {
            cloudData.wordBank = cloudData.wordBank.filter(w => !toDel.includes(w));
            cloudData.publishedWords = cloudData.publishedWords.filter(w => !toDel.includes(w));
            await updateCloudConfig({ wordBank: cloudData.wordBank, publishedWords: cloudData.publishedWords });
            renderTeacherDash();
        }
    }

    function renderWordListOnly() {
        const list = document.getElementById('word_list');
        list.innerHTML = "";
        cloudData.wordBank.forEach(w => {
            list.innerHTML += `<div><input type="checkbox" class="word-checkbox" value="${w}"> ${w}</div>`;
        });
    }

    function renderTeacherDash() {
        document.getElementById('room_display').innerText = cloudData.roomID || "--";
        document.getElementById('published_display').innerText = cloudData.publishedWords.join(', ') || "ç„¡";
        const chips = document.getElementById('room_chips_container');
        chips.innerHTML = "";
        cloudData.roomList.forEach(id => {
            const active = (id === cloudData.roomID) ? "active" : "";
            chips.innerHTML += `<div class="room-chip ${active}" onclick="selectRoom('${id}')">ğŸ  ${id}<span class="del-x" onclick="deleteRoom('${id}', event)">Ã—</span></div>`;
        });
        renderWordListOnly();
        const { db, collection, query, where, onSnapshot } = window.firebaseDB;
        if(unsubResults) unsubResults();
        const q = query(collection(db, "results"), where("room", "==", cloudData.roomID));
        unsubResults = onSnapshot(q, (snapshot) => {
            const tbody = document.querySelector('#leaderboard tbody');
            tbody.innerHTML = "";
            let data = [];
            snapshot.forEach(doc => data.push(doc.data()));
            data.sort((a,b) => b.avg - a.avg).forEach(r => {
                let detail = Object.entries(r.details).map(([w, s]) => `${w}: ${s}`).join(' | ');
                let thumbHtml = r.bestImg ? `<img src="${r.bestImg}" class="work-thumb" onclick="openArt('${r.bestImg}', '${r.name}')">` : "-";
                tbody.innerHTML += `<tr><td>${thumbHtml}</td><td><b>[${r.class}] ${r.name}</b></td><td style="color:#00FF00; font-size:16px;">${r.avg}</td><td style="text-align:left; font-size:11px; color:#bbb;">${detail}</td><td>${r.finished}/${r.total}</td></tr>`;
            });
        });
    }

    function openArt(src, name) { document.getElementById('big_art').src = src; document.getElementById('art_info').innerText = "å­¸ç”Ÿ: " + name; document.getElementById('artwork_modal').style.display = "flex"; }
    function closeArt() { document.getElementById('artwork_modal').style.display = "none"; }

    let studentState = { room:"", class:"", name:"", queue:[], currentIdx: 0, scores:{}, bestScore: 0, bestImg: "" };
    async function handleStudentEntry() {
        await syncConfigFromCloud();
        let room = document.getElementById('s_room_input').value.trim();
        if(!cloudData.roomList.includes(room)) { alert("æˆ¿è™Ÿä¸å­˜åœ¨ï¼"); return; }
        if(cloudData.publishedWords.length === 0) { alert("å…§å®¹æœªç™¼ä½ˆï¼"); return; }
        studentState = { room, class: document.getElementById('s_class').value, name: document.getElementById('s_name').value, queue: [...cloudData.publishedWords], currentIdx: 0, scores: {}, bestScore: 0, bestImg: "" };
        showPage('page_writing');
    }

    function updateWritingUI() {
        const w = studentState.queue[studentState.currentIdx];
        document.getElementById('target_word').innerText = w || "END";
        document.getElementById('progress_info').innerText = `é€²åº¦: ${studentState.currentIdx + 1} / ${studentState.queue.length}`;
        document.getElementById('btn_submit_score').disabled = false;
        document.getElementById('btn_submit_score').innerText = "æäº¤è©•åˆ†";
    }

    const video = document.getElementById('input_video'), canvas = document.getElementById('overlay_canvas'), ctx = canvas.getContext('2d');
    let allPaths = [], currentStroke = [], lastX = 0, lastY = 0;

    function onResults(res) {
        ctx.save(); ctx.translate(canvas.width, 0); ctx.scale(-1, 1);
        ctx.drawImage(res.image, 0, 0, canvas.width, canvas.height);
        const w = studentState.queue[studentState.currentIdx];
        if(w) {
            let fs = Math.min(250, (canvas.width / w.length) * 1.2);
            ctx.save(); ctx.translate(canvas.width/2, canvas.height/2); ctx.scale(-1, 1); ctx.globalAlpha = 0.5; ctx.fillStyle = 'white';
            ctx.font = `bold ${fs}px Arial`; ctx.textAlign = "center"; ctx.textBaseline = "middle";
            ctx.fillText(w, 0, 0); ctx.restore();
        }
        if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
            const h = res.multiHandLandmarks[0];
            const d = Math.sqrt(Math.pow(h[4].x-h[8].x,2)+Math.pow(h[4].y-h[8].y,2));
            const rx = h[8].x * canvas.width, ry = h[8].y * canvas.height;
            if (lastX === 0) { lastX = rx; lastY = ry; }
            const sx = lastX + (rx - lastX) * 0.3, sy = lastY + (ry - lastY) * 0.3;
            lastX = sx; lastY = sy;
            if (d < 0.035) currentStroke.push({ x: sx, y: sy });
            else if (currentStroke.length > 0) { allPaths.push([...currentStroke]); currentStroke = []; }
            ctx.fillStyle = "red"; ctx.beginPath(); ctx.arc(sx, sy, 8, 0, Math.PI*2); ctx.fill();
        }
        ctx.strokeStyle = '#00FF00'; ctx.lineWidth = 15; ctx.lineCap = 'round';
        [...allPaths, currentStroke].forEach(p => {
            if (p.length < 2) return;
            ctx.beginPath(); ctx.moveTo(p[0].x, p[0].y);
            for(let i=1; i<p.length-1; i++) ctx.quadraticCurveTo(p[i].x, p[i].y, (p[i].x+p[i+1].x)/2, (p[i].y+p[i+1].y)/2);
            ctx.stroke();
        });
        ctx.restore();
    }

    async function calculateFinalScore() {
        const btn = document.getElementById('btn_submit_score');
        btn.disabled = true;
        btn.innerText = "è©•åˆ†ä¸­...";

        const w = studentState.queue[studentState.currentIdx];
        const off = document.createElement('canvas'); off.width = canvas.width; off.height = canvas.height;
        const octx = off.getContext('2d');
        let fs = Math.min(250, (off.width / w.length) * 1.2);
        octx.save(); octx.translate(off.width/2, off.height/2); octx.scale(-1,1); octx.font = `bold ${fs}px Arial`; octx.textAlign="center"; octx.textBaseline="middle"; octx.lineWidth = 25; octx.strokeText(w, 0, 0); octx.fillText(w, 0, 0); octx.restore();
        const tD = octx.getImageData(0,0,off.width,off.height).data;
        octx.clearRect(0,0,off.width,off.height); octx.strokeStyle = '#00FF00'; octx.lineWidth = 15; octx.lineCap = 'round';
        [...allPaths, currentStroke].forEach(p => {
            if (p.length < 2) return;
            octx.beginPath(); octx.moveTo(p[0].x, p[0].y);
            for(let i=1; i<p.length-1; i++) octx.quadraticCurveTo(p[i].x, p[i].y, (p[i].x+p[i+1].x)/2, (p[i].y+p[i+1].y)/2);
            octx.stroke();
        });
        let img = off.toDataURL("image/png");
        const sD = octx.getImageData(0,0,off.width,off.height).data;
        let m=0, t=0; for (let i=3; i<tD.length; i+=16) { if(tD[i]>0){ t++; if(sD[i]>0) m++; } }
        
        let coverage = (m/t)*100;
        let finalScore = 0;
        if (coverage > 65) { finalScore = 90 + (coverage - 65) / 3.5; }
        else if (coverage > 35) { finalScore = 70 + (coverage - 35) * 0.6; }
        else if (coverage > 10) { finalScore = 40 + (coverage * 2); }
        else { finalScore = 20; }
        
        finalScore = Math.min(100, Math.round(finalScore));
        studentState.scores[w] = finalScore;
        if (finalScore >= studentState.bestScore) { studentState.bestScore = finalScore; studentState.bestImg = img; }

        const { db, setDoc, doc } = window.firebaseDB;
        let fin = Object.keys(studentState.scores).length, tot = studentState.queue.length, av = Math.round(Object.values(studentState.scores).reduce((a,b)=>a+b,0) / fin);
        await setDoc(doc(db, "results", `${studentState.room}_${studentState.class}_${studentState.name}`), {
            room: studentState.room, class: studentState.class, name: studentState.name, details: studentState.scores, finished: fin, total: tot, avg: av, bestImg: studentState.bestImg
        });
        
        document.getElementById('res_score').innerText = finalScore;
        document.getElementById('res_stars').innerText = "â­".repeat(finalScore >= 90 ? 5 : (finalScore >= 75 ? 4 : 3));
        document.getElementById('result_modal').style.display = "block";
    }

    function toNextStep() {
        document.getElementById('result_modal').style.display = "none";
        clearCanvas();
        if(studentState.currentIdx < studentState.queue.length - 1) {
            studentState.currentIdx++;
            updateWritingUI();
        } else {
            alert("æŒ‘æˆ°çµæŸ");
            showPage('page_entry');
        }
    }

    async function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'page_teacher_dash') { await syncConfigFromCloud(); renderTeacherDash(); }
        if(id === 'page_writing') {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            updateWritingUI();
            const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
            hands.setOptions({ maxNumHands:1, modelComplexity:1, minDetectionConfidence:0.7, minTrackingConfidence:0.7 });
            hands.onResults(onResults);
            new Camera(video, { onFrame: async () => { await hands.send({image: video}); }, width:1280, height:720 }).start();
        }
    }
    function clearCanvas() { allPaths = []; currentStroke = []; lastX = 0; lastY = 0; }
    async function clearScores() { if(confirm("æ¸…ç©ºï¼Ÿ")) { const { db, collection, query, where, getDocs, deleteDoc, doc } = window.firebaseDB; const snapshot = await getDocs(query(collection(db, "results"), where("room", "==", cloudData.roomID))); snapshot.forEach(async (d) => await deleteDoc(doc(db, "results", d.id))); } }
</script>
</body>
</html>
